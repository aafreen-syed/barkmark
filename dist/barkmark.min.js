!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.barkmark=e()}}(function(){return function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return o(n?n:e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t){"use strict";function n(e,t){function n(e){var t=c(i);e.addEventListener("keypress",a),e.addEventListener("keydown",c(r)),e.addEventListener("keydown",c(o)),e.addEventListener("mousedown",s),e.onpaste=t,e.ondrop=t}function s(){l.setMode("moving")}function c(e){return function(t){return e.call(null,l,t)}}var l=this;l.inputMode=t,l.surface=e,l.reset(),n(e.current())}function r(e,t){var n=!1,r=t.charCode||t.keyCode,o=String.fromCharCode(r);if(t.ctrlKey||t.metaKey)switch(o.toLowerCase()){case"y":e.redo(),n=!0;break;case"z":t.shiftKey?e.redo():e.undo(),n=!0}n&&t.preventDefault&&t.preventDefault()}function o(e,t){if(!t.ctrlKey&&!t.metaKey){var n=t.keyCode;n>=33&&40>=n||n>=63232&&63235>=n?e.setMode("moving"):8===n||46===n||127===n?e.setMode("deleting"):13===n?e.setMode("newlines"):27===n?e.setMode("escape"):(16>n||n>20)&&91!==n&&e.setMode("typing")}}function i(e){e.inputState&&e.inputState.text!==e.surface.read(e.inputMode)&&null===e.refreshing&&(e.historyMode="paste",e.saveState(),e.refreshState())}function a(e){var t=e.charCode||e.keyCode,n=89===t||90===t,r=e.ctrlKey||e.metaKey;r&&n&&e.preventDefault()}var s=e("./InputState");n.prototype.setInputMode=function(e){var t=this;t.inputMode=e,t.reset()},n.prototype.reset=function(){var e=this;return e.inputState=null,e.lastState=null,e.history=[],e.historyPointer=0,e.historyMode="none",e.refreshing=null,e.refreshState(!0),e.saveState(),e},n.prototype.setCommandMode=function(){var e=this;e.historyMode="command",e.saveState(),e.refreshing=setTimeout(function(){e.refreshState()},0)},n.prototype.canUndo=function(){return this.historyPointer>1},n.prototype.canRedo=function(){return this.history[this.historyPointer+1]},n.prototype.undo=function(){var e=this;e.canUndo()&&(e.lastState?(e.lastState.restore(),e.lastState=null):(e.history[e.historyPointer]=new s(e.surface,e.inputMode),e.history[--e.historyPointer].restore())),e.historyMode="none",e.surface.focus(e.inputMode),e.refreshState()},n.prototype.redo=function(){var e=this;e.canRedo()&&e.history[++e.historyPointer].restore(),e.historyMode="none",e.surface.focus(e.inputMode),e.refreshState()},n.prototype.setMode=function(e){var t=this;t.historyMode!==e&&(t.historyMode=e,t.saveState()),t.refreshing=setTimeout(function(){t.refreshState()},1)},n.prototype.refreshState=function(e){var t=this;t.inputState=new s(t.surface,t.inputMode,e),t.refreshing=null},n.prototype.saveState=function(){var e=this,t=e.inputState||new s(e.surface,e.inputMode);return"moving"===e.historyMode?void(e.lastState||(e.lastState=t)):(e.lastState&&(e.history[e.historyPointer-1].text!==e.lastState.text&&(e.history[e.historyPointer++]=e.lastState),e.lastState=null),e.history[e.historyPointer++]=t,void(e.history[e.historyPointer+1]=null))},t.exports=n},{"./InputState":2}],2:[function(e,t){(function(n){"use strict";function r(e,t,n){this.mode=t,this.surface=e,this.initialState=n||!1,this.init()}var o=n.document,i=e("./isVisibleElement"),a=e("./fixEOL"),s=e("./markdown/MarkdownChunks"),c=e("./html/HtmlChunks"),l={markdown:s,html:c,wysiwyg:c};r.prototype.init=function(){var e=this,t=e.surface.current(e.mode);i(t)&&(this.initialState||!o.activeElement||o.activeElement===t)&&(e.surface.readSelection(e),e.scrollTop=t.scrollTop,e.text||(e.text=e.surface.read(e.mode)))},r.prototype.select=function(){var e=this,t=e.surface.current(e.mode);i(t)&&e.surface.writeSelection(e)},r.prototype.restore=function(){var e=this,t=e.surface.current(e.mode);"string"==typeof e.text&&e.text!==e.surface.read()&&e.surface.write(e.text),e.select(),t.scrollTop=e.scrollTop},r.prototype.getChunks=function(){var e=this,t=new l[e.mode];return t.before=a(e.text.substring(0,e.start)),t.startTag="",t.selection=a(e.text.substring(e.start,e.end)),t.endTag="",t.after=a(e.text.substring(e.end)),t.scrollTop=e.scrollTop,e.cachedChunks=t,t},r.prototype.setChunks=function(e){var t=this;e.before=e.before+e.startTag,e.after=e.endTag+e.after,t.start=e.before.length,t.end=e.before.length+e.selection.length,t.text=e.before+e.selection+e.after,t.scrollTop=e.scrollTop},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./fixEOL":11,"./html/HtmlChunks":13,"./isVisibleElement":22,"./markdown/MarkdownChunks":25}],3:[function(e,t){"use strict";function n(e,t){return o.get(e,t)}var r=e("./manager"),o=new r;n.find=function(e){return o.find(e)},n.strings=e("./strings"),t.exports=n},{"./manager":23,"./strings":43}],4:[function(e,t){"use strict";function n(e,t){function n(e){return function(){r.dispatchClickEvent(e)}}function i(e,t){o[e].boldOrItalic(t,"bold")}function a(e,t){o[e].boldOrItalic(t,"italic")}function s(e,n){o[e].codeblock(n,{fencing:t.fencing})}function c(e,t){o[e].list(t,!1)}function l(e,t){o[e].list(t,!0)}function u(n,r){return function(i,a){o[i].linkOrImageOrAttachment.call(this,a,{editor:e,mode:i,type:n,prompts:t.prompts,upload:t[n+"s"],classes:t.classes,mergeHtmlAndAttachment:t.mergeHtmlAndAttachment,autoUpload:r})}}function p(t,n,r,o){return 3===arguments.length&&(o=r,r=void 0),e.addCommandButton(t,n,r,h(o))}function d(e){return function(t,n){o[t][e].call(this,n)}}function f(e){e.preventDefault(),e.stopPropagation()}function h(e){return function(t,n,r){f(t),e.call(this,n,r)}}p("bold","b",i),p("italic","i",a),p("quote","j",d("blockquote")),p("code","e",s),p("ol","o",l),p("ul","u",c),p("heading","d",d("heading")),e.showLinkDialog=n(p("link","k",u("link"))),e.showImageDialog=n(p("image","g",u("image"))),e.linkOrImageOrAttachment=u,t.attachments&&(e.showAttachmentDialog=n(p("attachment","k",!0,u("attachment")))),t.hr&&p("hr","cmd+n",d("hr"))}var r=e("./utils"),o={markdown:{boldOrItalic:e("./markdown/boldOrItalic"),linkOrImageOrAttachment:e("./markdown/linkOrImageOrAttachment"),blockquote:e("./markdown/blockquote"),codeblock:e("./markdown/codeblock"),heading:e("./markdown/heading"),list:e("./markdown/list"),hr:e("./markdown/hr")},html:{boldOrItalic:e("./html/boldOrItalic"),linkOrImageOrAttachment:e("./html/linkOrImageOrAttachment"),blockquote:e("./html/blockquote"),codeblock:e("./html/codeblock"),heading:e("./html/heading"),list:e("./html/list"),hr:e("./html/hr")}};o.wysiwyg=o.html,t.exports=n},{"./html/blockquote":14,"./html/boldOrItalic":15,"./html/codeblock":16,"./html/heading":17,"./html/hr":18,"./html/linkOrImageOrAttachment":19,"./html/list":20,"./markdown/blockquote":26,"./markdown/boldOrItalic":27,"./markdown/codeblock":28,"./markdown/heading":29,"./markdown/hr":30,"./markdown/linkOrImageOrAttachment":31,"./markdown/list":32,"./utils":45}],5:[function(e,t){"use strict";function n(e){function t(e,t,n){var s=t.replace(/\?.*$/,r);return s=decodeURIComponent(s),s=encodeURI(s).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29"),s=s.replace(/\?.*$/,o),{href:a(s),title:i(n)}}return t.apply(null,e.match(s))}function r(e){return e.replace(/\+/g," ")}function o(e){return e.replace(/\+/g,"%2b")}function i(e){return e?e.replace(/^\s+|\s+$/g,"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):null}function a(e){var t=e.replace(/^\s+|\s+$/g,"");return t.length&&"/"!==t[0]&&!c.test(t)?"http://"+t:t}var s=/^\s*(.*?)(?:\s+"(.+)")?\s*$/,c=/^(?:https?|ftp):\/\//;t.exports=n},{}],6:[function(e,t){"use strict";function n(e){function t(e){return r.before+=e,""}function n(e){return r.after=e+r.after,""}var r=this;e&&(t=n=""),r.selection=r.selection.replace(/^(\s*)/,t).replace(/(\s*)$/,n)}t.exports=n},{}],7:[function(e,t){"use strict";function n(e,t){var n=e.className;-1===n.indexOf(t)&&(e.className=(n+" "+t).replace(o,""))}function r(e,t){e.className=e.className.replace(t,"").replace(o,"").replace(i," ")}var o=/^\s+|\s+$/g,i=/\s+/g;t.exports={add:n,rm:r}},{}],8:[function(e,t){(function(n){"use strict";function r(e,t){this.textarea=e;var n=e.parentNode,r=this.options=c.defaultsDeep(t||{},{markdown:!0,wysiwyg:!0,hr:!1,storage:!0,fencing:!0,render:{modes:{},commands:{}},prompts:{link:y,image:y,attachment:y,close:b},classes:{wysiwyg:[],prompts:{},input:{}}});if(!r.markdown&&!r.wysiwyg)throw new Error("barkmark expects at least one input mode to be available");r.storage===!0&&(r.storage="barkmark_input_mode");var o=r.storage&&JSON.parse(localStorage.getItem(r.storage));o&&(r.defaultMode=o),this.components={textarea:e,parent:e.parentNode,droparea:i({c:"wk-container-drop"}),switchboard:i({c:"wk-switchboard"}),commands:i({c:"wk-commands"})},this.shortcuts=new d,this.modes={},this.mode="markdown",i({t:"span",c:"wk-drop-text",x:l.prompts.drop,p:this.components.droparea}),i({t:"p",c:["wk-drop-icon"].concat(r.classes.dropicon).join(" "),p:this.components.droparea}),g.add(n,"wk-container"),n.insertBefore(this.components.commands,this.textarea),this.placeholder&&n.appendChild(this.placeholder),n.appendChild(this.components.switchboard),r.markdown&&this.registerMode("markdown",h,{active:!r.defaultMode||!r[r.defaultMode]||"markdown"===r.defaultMode,shortcutKey:"m"}),r.wysiwyg&&(this.registerMode("wysiwyg",m,{active:"wysiwyg"===r.defaultMode||!r.markdown,shortcutKey:"p",classes:r.classes.wysiwyg||[]}),this.placeholder=i({c:"wk-wysiwyg-placeholder wk-hide",x:e.placeholder}),this.placeholder.addEventListener("click",this.modes.wysiwyg.surface.focus.bind(this.modes.wysiwyg.surface))),u(this,r)}function o(e){var t=this;setTimeout(function(){c.dispatchCustomEvent(t.textarea,e)},0)}function i(e){var t=e||{},n=k.createElement(t.t||"div");return n.className=t.c||"",n.textContent=t.x||"",t.p&&t.p.appendChild(n),n}function a(e){e&&(e.preventDefault(),e.stopPropagation())}function s(e){return e.replace(/\bctrl\b/i,"⌘").replace(/\balt\b/i,"⌥").replace(/\bshift\b/i,"⇧")}var c=e("./utils"),l=e("./strings"),u=e("./bindCommands"),p=e("./InputHistory"),d=e("./shortcuts"),f=e("./getCommandHandler"),h=e("./modes/markdown/textareaSurface"),m=e("./modes/wysiwyg/wysiwygSurface"),g=e("./classes"),v=e("./renderers"),y=e("./prompts/prompt"),b=e("./prompts/close"),w=/\bMac OS\b/.test(n.navigator.userAgent),k=document;r.prototype.getSurface=function(){return this.modes[this.mode].surface},r.prototype.addCommand=function(e,t,n){2===arguments.length&&(n=t,t=void 0),this.shortcuts.add(e,t,f(this,this.modes[this.mode].history,n))},r.prototype.addCommandButton=function(e,t,n,r){2===arguments.length?(r=t,t=void 0,n=void 0):3===arguments.length&&(r=n,n=void 0);var o=i({t:"button",c:"wk-command",p:this.components.commands}),a=this.options.render.commands,c="function"==typeof a?a:v.commands,u=l.titles[e];return u&&o.setAttribute("title",w?s(u):u),o.type="button",o.tabIndex=-1,c(o,e),o.addEventListener("click",f(this,this.modes[this.mode].history,r)),t&&this.addCommand(t,n,r),o},r.prototype.runCommand=function(e){function t(t,n,r){return e.call(this,r,n)}f(this,this.modes[this.mode].history,t)(null)},r.prototype.parseMarkdown=function(){return this.options.parseMarkdown.apply(this.options.parseMarkdown,arguments)},r.prototype.parseHTML=function(){return this.options.parseHTML.apply(this.options.parseHTML,arguments)},r.prototype.destroy=function(){"markdown"!==this.mode&&(this.textarea.value=this.getMarkdown()),g.rm(this.textarea,"wk-hide"),this.shortcuts.clear();var e=this.components.parent;g.rm(e,"wk-container"),e.removeChild(this.components.commands),this.placeholder&&e.removeChild(this.placeholder),e.removeChild(this.components.switchboard);var t=Object.keys(this.modes),n=this;t.forEach(function(t){n.modes[t].element!==n.textarea&&e.removeChild(n.modes[t].element),this.shortcuts.detach(n.modes[t].element)})},r.prototype.value=function(e){function t(){return r.options.parseMarkdown(n)}var n=String(e),r=this,o=1===arguments.length;return o&&("wysiwyg"===this.mode&&(n=t()),this.getSurface().write(n),this.modes[this.mode].history.reset()),this.getMarkdown()},r.prototype.registerMode=function(e,t,n){var r=["wk-mode"];r.push(n.active?"wk-mode-active":"wk-mode-inactive");var o=this.modes[e]={button:i({t:"button",c:r.join(" ")}),surface:new t(this,n)};o.element=o.surface.current(),o.history=new p(o.surface,e),o.element!==this.textarea&&this.components.parent.insertBefore(o.element,this.components.switchboard),this.components.switchboard.appendChild(o.button),o.button.textContent=l.modes[e]||e,o.button.addEventListener("click",this.setMode.bind(this,e)),o.button.type="button",o.button.tabIndex=-1;var a=l.titles[e];return a&&o.button.setAttribute("title",w?s(a):a),this.shortcuts.attach(o.element),n.shortcutKey&&this.shortcuts.add(n.shortcutKey,!!n.shift,this.setMode.bind(this,e)),n.active&&(this.setMode(e),o.button.setAttribute("disabled",!0)),o},r.prototype.setMode=function(e,t){function n(){s.element!==r.textarea&&(r.textarea.value=s.surface.toMarkdown(),c.dispatchBrowserEvent(r.textarea,"input"),c.dispatchBrowserEvent(r.textarea,"change"))}var r=this,i=this.modes[this.mode]||{},s=this.modes[e],l=i.button,u=s.button,p=!!t||k.activeElement===i.element||k.activeElement===s.element;a(t),i!==s&&(this.textarea.blur(),i.surface.off("change",n),s.surface.writeMarkdown(i.surface.toMarkdown()),s.surface.on("change",n),g.add(i.element,"wk-hide"),g.rm(s.element,"wk-hide"),"wysiwyg"===e?this.placeholder&&g.rm(this.placeholder,"wk-hide"):this.placeholder&&g.add(this.placeholder,"wk-hide"),p&&s.surface.focus(),g.add(u,"wk-mode-active"),g.rm(l,"wk-mode-active"),g.add(l,"wk-mode-inactive"),g.rm(u,"wk-mode-inactive"),u.setAttribute("disabled","disabled"),l.removeAttribute("disabled"),this.mode=e,this.options.storage&&localStorage.setItem(this.options.storage,JSON.stringify(e)),o.call(this,"barkmark-mode-change"))},r.prototype.getMarkdown=function(){return this.getSurface().toMarkdown()},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./InputHistory":1,"./bindCommands":4,"./classes":7,"./getCommandHandler":12,"./modes/markdown/textareaSurface":35,"./modes/wysiwyg/wysiwygSurface":36,"./prompts/close":38,"./prompts/prompt":39,"./renderers":41,"./shortcuts":42,"./strings":43,"./utils":45}],9:[function(e,t){"use strict";function n(e,t){this.name=e,this.details=t,this.executionStopped=!1}function r(e,t){this._events=this._events||{},this._events[e]||(this._events[e]=[]),this._events[e].push(t)}function o(e,t){if(this._events=this._events||{},!this._events[e])return!1;if(1===arguments.length)delete this._events[e];else{var n=this._events[e].indexOf(t);if(0>n)return!1;this._events[e].splice(n,1),this._events[e].length||delete this._events[e]}return!0}function i(e){if(this._events=this._events||{},this._events[e]){var t=new n(e,Array.prototype.slice.call(arguments,1)),r=Array.prototype.slice.call(arguments,1);r.unshift(t);for(var o=0;o<this._events[e].length&&(this._events[e][o].apply(this,r),!t.executionStopped);o++);return t}}n.prototype.stopPropagation=n.prototype.stopExecution=function(){this.executionStopped=!0},t.exports={extend:function(e){e.prototype.on=r.bind(e),e.prototype.off=o.bind(e),e.prototype.trigger=i.bind(e)}}},{}],10:[function(e,t){"use strict";function n(e,t,n){function r(e,t){return o=t,""}var o,i=e.toString();return i=i.replace(/\/([gim]*)$/,r),i=i.replace(/(^\/|\/$)/g,""),i=t+i+n,new RegExp(i,o)}t.exports=n},{}],11:[function(e,t){"use strict";function n(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")}t.exports=n},{}],12:[function(e,t){"use strict";function n(e,t,n){return function(o){function i(){return u.immediate=!1,a}function a(){s.focus(),c.setChunks(l),c.restore()}var s=e.getSurface();s.focus(!0),t.setCommandMode();var c=new r(s,e.mode),l=c.getChunks(),u={async:i,immediate:!0};n.call(u,o,e.mode,l),u.immediate&&a()}}var r=e("./InputState");t.exports=n},{"./InputState":2}],13:[function(e,t){"use strict";function n(){}var r=e("../chunks/trim");n.prototype.trim=r,n.prototype.findTags=function(){},n.prototype.skip=function(){},t.exports=n},{"../chunks/trim":6}],14:[function(e,t){"use strict";function n(e){o("blockquote",r.placeholders.quote,e)}var r=e("../strings"),o=e("./wrapping");t.exports=n},{"../strings":43,"./wrapping":21}],15:[function(e,t){"use strict";function n(e,t){o("bold"===t?"strong":"em",r.placeholders[t],e)}var r=e("../strings"),o=e("./wrapping");t.exports=n},{"../strings":43,"./wrapping":21}],16:[function(e,t){"use strict";function n(e){o("pre><code",r.placeholders.code,e)}var r=e("../strings"),o=e("./wrapping");t.exports=n},{"../strings":43,"./wrapping":21}],17:[function(e,t){"use strict";function n(e){function t(){var t=parseInt(s[1],10),n=1>=t?4:t-1;e.before=e.before.replace(o,"<h"+n+">"),e.after=e.after.replace(i,"</h"+n+">")}function n(){e.selection||(e.selection=r.placeholders.heading),e.before+="<h1>",e.after="</h1>"+e.after}e.trim();var a=i.exec(e.after),s=o.exec(e.before);s&&a&&s[1]===a[1]?t():n()}var r=e("../strings"),o=/<h([1-6])( [^>]*)?>$/,i=/^<\/h([1-6])>/;t.exports=n},{"../strings":43}],18:[function(e,t){"use strict";function n(e){e.before+="\n<hr>\n",e.selection=""}t.exports=n},{}],19:[function(e,t){"use strict";function n(e,t){function n(){if(f){if(l.test(e.selection))return e.selection="",!0}else if(c.exec(e.after)&&s.exec(e.before))return e.before=e.before.replace(s,""),e.after=e.after.replace(c,""),!0}function u(n){function o(e){return e.href.length>0}function s(e){return e.title?' title="'+e.title+'"':""}function c(t,n){function r(e){return'<img src="'+e.href+'" alt="'}function o(e){return'"'+s(e)+" />"}function i(e){return" "+r(e)+o(e)}var a=e.after;e.before+=r(t),e.after=o(t),n.length&&(e.after+=n.map(i).join("")),e.after+=a}function l(n,r){function o(e){return'<a href="'+e.href+'"'+s(e)+u+' target="_blank" rel="noopener noreferrer">'}function i(){return"</a>"}function a(e){return" "+o(e)+i()}var c=e.after,l=t.classes.input.links,u=l?' class="'+l+'"':"";e.before+=o(n),e.after=i(),r.length&&(e.after+=r.map(a).join("")),e.after+=c}var u,h=n.definitions.map(a).filter(o);if(0===h.length)return void p();var m=h[0];return"attachment"===d?(u=t.mergeHtmlAndAttachment(e.before+e.selection+e.after,m),e.before=u.before,e.selection=u.selection,e.after=u.after,p(),void r.dispatchCustomEvent(t.surface.textarea,"woofmark-mode-change")):(f?c(m,h.slice(1)):l(m,h.slice(1)),e.selection||(e.selection=i.placeholders[d]),void p())}var p,d=t.type,f="image"===d;"attachment"!==d&&e.trim(),n()||(p=this.async(),t.prompts.close(),(t.prompts[d]||t.prompts.link)(t,o(u)))}var r=e("../utils"),o=e("../once"),i=e("../strings"),a=e("../chunks/parseLinkInput"),s=/<a( [^>]*)?>$/,c=/^<\/a>/,l=/<img( [^>]*)?\/>$/;t.exports=n},{"../chunks/parseLinkInput":5,"../once":37,"../strings":43,"../utils":45}],20:[function(e,t){"use strict";function n(e,t){function n(t){var n=t?"":u,o=t?"":p;e.before+=n+"<li>",e.after="</li>"+o+e.after,e.selection||(e.selection=r.placeholders.listitem)}var l=t?"ol":"ul",u="<"+l+">",p="</"+l+">";if(e.trim(),o.test(e.before)&&i.test(e.after)&&l===RegExp.$1)return e.before=e.before.replace(o,""),void(e.after=e.after.replace(i,""));var d=e.before.lastIndexOf("<ul"),f=e.before.lastIndexOf("<ol"),h=e.after.indexOf("</ul>");if(-1===h&&(h=e.after.indexOf("</ol>")),-1===h)return void n();var m=d>f?d:f;if(-1===m)return void n();var g=e.before.indexOf(">",m);if(-1===g)return void n();var v=e.before.substr(m,g-m+1);c.test(v)&&(l!==RegExp.$1?(e.before=e.before.substr(0,m)+"<"+l+e.before.substr(m+3),e.after=e.after.substr(0,h)+"</"+l+e.after.substr(h+4)):a.test(e.before)&&s.test(e.after)?(e.before=e.before.replace(a,""),e.after=e.after.replace(s,"")):n(!0))}var r=e("../strings"),o=/<(ul|ol)( [^>]*)?>\s*<li( [^>]*)?>$/,i=/^<\/li>\s*<\/(ul|ol)>/,a=/<li( [^>]*)?>$/,s=/^<\/li( [^>]*)?>/,c=/^<(ul|ol)( [^>]*)?>$/;t.exports=n},{"../strings":43}],21:[function(e,t){"use strict";function n(e,t,n){function i(){n.selection.replace(/<(\/)?([^> ]+)( [^>]*)?>/gi,a)}function a(e,t,r,o,i){var a=o||"",s=!t,c=new RegExp("</"+r.replace(/</g,"</")+">","i"),l=new RegExp("<"+r+"( [^>]*)?>","i");s&&!c.test(n.selection.substr(i))&&(n.selection+="</"+r+">",n.after=n.after.replace(/^(<\/[^>]+>)/,"$1<"+r+a+">")),t&&!l.test(n.selection.substr(0,i))&&(n.selection="<"+r+a+">"+n.selection,n.before=n.before.replace(/(<[^>]+(?: [^>]*)?>)$/,"</"+r+">$1"))}var s="<"+e,c="</"+e.replace(/</g,"</"),l=new RegExp(s+"( [^>]*)?>$","i"),u=new RegExp("^"+c+">","i"),p=new RegExp(s+"( [^>]*)?>","ig"),d=new RegExp(c+"( [^>]*)?>","ig");n.trim();var f=u.exec(n.after),h=l.exec(n.before);if(h&&f)n.before=n.before.replace(l,""),n.after=n.after.replace(u,"");else{n.selection||(n.selection=t);var m=p.test(n.selection);m&&(n.selection=n.selection.replace(p,""),o(n,e)||(n.before+=s+">"));var g=d.test(n.selection);if(g&&(n.selection=n.selection.replace(d,""),o(n,e)||(n.after=c+">"+n.after)),m||g)return void i();o(n,e)?(l.test(n.before)?n.before=n.before.replace(l,""):n.before+=c+">",n.after=u.test(n.after)?n.after.replace(u,""):s+">"+n.after):r(n,e)||(n.after=c+">"+n.after,n.before+=s+">"),i()}}function r(e,t){var n=new RegExp("</"+t.replace(/</g,"</")+">$","i"),r=new RegExp("^<"+t+"(?: [^>]*)?>","i"),o=n.test(e.before)&&r.test(e.after);return o&&(e.before=e.before.replace(n,""),e.after=e.after.replace(r,"")),o}function o(e,t){function n(e,t){var n=e.match(t);return n?n.length:0}var r=new RegExp("<"+t+"(?: [^>]*)?>","ig"),o=new RegExp("</"+t.replace(/</g,"</")+">","ig"),i=n(e.before,r),a=n(e.after,r),s=n(e.before,o),c=n(e.after,o),l=i-s>0,u=c-a>0;return l&&u}t.exports=n},{}],22:[function(e,t){(function(e){"use strict";function n(t){return e.getComputedStyle?"none"!==e.getComputedStyle(t,null).getPropertyValue("display"):t.currentStyle?"none"!==t.currentStyle.display:void 0}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],23:[function(e,t){"use strict";function n(){this.cache=[]}var r=[],o=e("./editor");n.prototype.find=function(e){for(var t=0,n=this.cache.length;n>t;t++)if(this.cache[t]&&this.cache[t].textarea===e)return this.cache[t]},n.prototype.get=function(e,t){var n=this.find(e);return n?n.editor:(n=new o(e,t),r.push({textarea:e,editor:n,options:t}),n)},n.prototype.remove=function(e){var t=this.find(e);return t?(t.editor.destroy(),r.splice(r.indexOf(t),1),!0):!1},n.prototype.clear=function(){for(var e;e=this.cache.pop();)e.editor.destroy()},n.prototype.each=function(e){for(var t=0,n=this.cache.length;n>t;t++){var r=this.cache[t];e(r.editor,r.textarea,r.options)}},t.exports=n},{"./editor":8}],24:[function(e,t){"use strict";function n(e,t){return new Array(t+1).join(e)}t.exports=n},{}],25:[function(e,t){"use strict";function n(){}var r=e("../many"),o=e("../extendRegExp"),i=e("../chunks/trim");n.prototype.trim=i,n.prototype.findTags=function(e,t){function n(e){return a.startTag=a.startTag+e,""}function r(e){return a.endTag=e+a.endTag,""}var i,a=this;e&&(i=o(e,"","$"),this.before=this.before.replace(i,n),i=o(e,"^",""),this.selection=this.selection.replace(i,n)),t&&(i=o(t,"","$"),this.selection=this.selection.replace(i,r),i=o(t,"^",""),this.after=this.after.replace(i,r))},n.prototype.skip=function(e){function t(e,t,o){var i=n.any?"\\n*":r("\\n?",t),a=r("\n",t);return e.replace(new RegExp(i+o),a)}var n=e||{},o="before"in n?n.before:1,i="after"in n?n.after:1;this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+RegExp.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+RegExp.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+RegExp.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+RegExp.$1,this.before&&(this.before=t(this.before,++o,"$")),this.after&&(this.after=t(this.after,++i,""))},t.exports=n},{"../chunks/trim":6,"../extendRegExp":10,"../many":24}],26:[function(e,t){"use strict";function n(e){function t(t,n,r,o){return e.before+=n,e.after=o+e.after,r}function n(t,n){return e.selection=n+e.selection,""}function d(t,n){return e.startTag+=n,""}function f(){for(var t,n=e.before.replace(/\n$/,"").split("\n"),r=!1,o=0;o<n.length;o++)t=!1,g=n[o],r=r&&g.length>0,/^>/.test(g)?(t=!0,!r&&g.length>1&&(r=!0)):t=/^[ \t]*$/.test(g)?!0:r,t?v+=g+"\n":(y+=v+g,v="\n");/(^|\n)>/.test(v)||(y+=v,v="")}function h(t){return e.endTag=t,""}function m(t){function n(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,r)+"\n"}var r=t?"> ":"";e.startTag&&(e.startTag=e.startTag.replace(p,n)),e.endTag&&(e.endTag=e.endTag.replace(u,n))}var g,v="",y="";e.selection=e.selection.replace(c,t),e.before=e.before.replace(a,n),e.selection=e.selection.replace(/^(\s|>)+$/,""),e.selection=e.selection||r.placeholders.quote,e.before&&f(),e.startTag=v,e.before=y,e.after&&(e.after=e.after.replace(/^\n?/,"\n")),e.after=e.after.replace(l,h),/^(?![ ]{0,3}>)/m.test(e.selection)?(o.wrap(e,i.lineLength-2),e.selection=e.selection.replace(/^/gm,"> "),m(!0),e.skip()):(e.selection=e.selection.replace(/^[ ]{0,3}> ?/gm,""),o.unwrap(e),m(!1),!/^(\n|^)[ ]{0,3}>/.test(e.selection)&&e.startTag&&(e.startTag=e.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(e.selection)&&e.endTag&&(e.endTag=e.endTag.replace(/^\n{0,2}/,"\n\n"))),/\n/.test(e.selection)||(e.selection=e.selection.replace(s,d))}var r=e("../strings"),o=e("./wrapping"),i=e("./settings"),a=/(>[ \t]*)$/,s=/^(>[ \t]*)/,c=/^(\n*)([^\r]+?)(\n*)$/,l=/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,u=/^\n((>|\s)*)\n/,p=/\n((>|\s)*)\n$/;t.exports=n},{"../strings":43,"./settings":33,"./wrapping":34}],27:[function(e,t){"use strict";function n(e,t){var n=/\n{2,}/g,s="bold"===t?2:1;e.trim(),e.selection=e.selection.replace(n,"\n");var c,l=o.exec(e.before)[0],u=r.exec(e.after)[0],p="\\*{"+s+"}",d=Math.min(l.length,u.length);d>=s&&(2!==d||1!==s)?(e.before=e.before.replace(new RegExp(p+"$",""),""),e.after=e.after.replace(new RegExp("^"+p,""),"")):!e.selection&&u?(e.after=e.after.replace(r,""),e.before=e.before.replace(i,"")+u+RegExp.$1):(e.selection||u||(e.selection=a.placeholders[t]),c=1===s?"*":"**",e.before=e.before+c,e.after=c+e.after)}var r=/^(\**)/,o=/(\**$)/,i=/(\s?)$/,a=e("../strings");t.exports=n},{"../strings":43}],28:[function(e,t){"use strict";function n(e,t){function n(){e.trim(),e.findTags(s,s),e.startTag||e.endTag?e.endTag&&!e.startTag?(e.before+=e.endTag,e.endTag=""):e.startTag=e.endTag="":(e.startTag=e.endTag="`",e.selection||(e.selection=r.placeholders.code))}function d(n){function o(t){return e.selection=t+e.selection,""}return n?(e.before=e.before.replace(c,""),void(e.after=e.after.replace(u,""))):(e.before=e.before.replace(/[ ]{4}|```[a-z]*\n$/,o),e.skip({before:/(\n|^)(\t|[ ]{4,}|```[a-z]*\n).*\n$/.test(e.before)?0:1,after:/^\n(\t|[ ]{4,}|\n```)/.test(e.after)?0:1}),void(e.selection?l.test(e.selection)&&p.test(e.selection)?e.selection=e.selection.replace(/(^```[a-z]*\n)|(```$)/g,""):/^[ ]{0,3}\S/m.test(e.selection)?t.fencing?(e.before+="```\n",e.after="\n```"+e.after):f?e.selection=e.selection.replace(/^/gm,"    "):e.before+="    ":e.selection=e.selection.replace(/^(?:[ ]{4}|[ ]{0,3}\t|```[a-z]*)/gm,""):(t.fencing?(e.startTag="```\n",e.endTag="\n```"):e.startTag="    ",e.selection=r.placeholders.code)))}var f=a.test(e.selection),h=i.test(e.after),m=o.test(e.before),g=c.test(e.before)&&u.test(e.after);g||f||!m&&!h?d(g):n()}var r=e("../strings"),o=/\S[ ]*$/,i=/^[ ]*\S/,a=/\n/,s=/`/,c=/```[a-z]*\n?$/,l=/^```[a-z]*\n/,u=/^\n?```/,p=/\n```$/;t.exports=n},{"../strings":43}],29:[function(e,t){"use strict";function n(e){var t=0;if(e.selection=e.selection.replace(/\s+/g," ").replace(/(^\s+|\s+$)/g,""),!e.selection)return e.startTag="# ",e.selection=o.placeholders.heading,e.endTag="",void e.skip({before:1,after:1});e.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(e.startTag)&&(t=RegExp.lastMatch.length),e.startTag=e.endTag="",e.findTags(null,/\s?(-+|=+)/),/=+/.test(e.endTag)&&(t=1),/-+/.test(e.endTag)&&(t=2),e.startTag=e.endTag="",e.skip({before:1,after:1});var n=2>t?4:t-1;n>0&&(e.startTag=r("#",n)+" ")}var r=e("../many"),o=e("../strings");t.exports=n},{"../many":24,"../strings":43}],30:[function(e,t){"use strict";function n(e){e.startTag="----------\n",e.selection="",e.skip({left:2,right:1,any:!0})}t.exports=n},{}],31:[function(e,t){"use strict";function n(e,t){function n(e,n,r,o,i){return t[n]=e.replace(/\s*$/,""),o?(t[n]=e.replace(/["(](.+?)[")]$/,""),o+i):""}return c.lastIndex=0,e.replace(c,n)}function r(e){function t(e){l.test(e)&&r(p[e])}function r(e){u++,e=e.replace(/^[ ]{0,3}\[(attachment-)?(\d+)\]:/,"  [$1"+u+"]:"),d.push(e)}function o(e,t,n,i,a,s){return n=n.replace(c,o),p[a]?(r(p[a]),t+n+i+u+s):e}var i=e.chunks,a=e.definition,s=e.attachment,c=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)((?:attachment-)?\d+)(\])/g,u=0,p={},d=[];i.before=n(i.before,p),i.selection=n(i.selection,p),i.after=n(i.after,p),i.before=i.before.replace(c,o),a?s||r(a):i.selection=i.selection.replace(c,o);var f=u;return i.after=i.after.replace(c,o),i.after&&(i.after=i.after.replace(/\n*$/,"")),i.after||(i.selection=i.selection.replace(/\n*$/,"")),u=0,Object.keys(p).forEach(t),s&&r(a),i.after+="\n\n"+d.join("\n"),f}function o(e,t){function n(t){function n(n,o){function i(){e.startTag=l?"![":"[",e.endTag="]["+d+"]",e.selection||(e.selection=a.placeholders[c]),o<u.length-1&&(e.before+=e.startTag+e.selection+e.endTag+"\n")}e.selection=(" "+e.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var s=t.attachment?"  [attachment-9999]: ":" [9999]: ",p=s+n.href+(n.title?' "'+n.title+'"':""),d=r({chunks:e,definition:p,attachment:t.attachment});t.attachment||i()}function i(e){return e.href.length>0}var u=t.definitions.map(s).filter(i);u.forEach(n),o()}var o,c=t.type,l="image"===c;return e.trim(),e.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/),e.endTag.length>1&&e.startTag.length>0?(e.startTag=e.startTag.replace(/!?\[/,""),e.endTag="",void r({chunks:e})):(e.selection=e.startTag+e.selection+e.endTag,e.startTag=e.endTag="",/\n\n/.test(e.selection)?void r({chunks:e}):(o=this.async(),t.prompts.close(),void(t.prompts[c]||t.prompts.link)(t,i(n))))}var i=e("../once"),a=e("../strings"),s=e("../chunks/parseLinkInput"),c=/^[ ]{0,3}\[((?:attachment-)?\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,l=/^attachment-(\d+)$/i;t.exports=o},{"../chunks/parseLinkInput":5,"../once":37,"../strings":43}],32:[function(e,t){"use strict";function n(e){return" "+e+" "}function r(e,t){function r(e){return u.test(e)&&(g=RegExp.$1),y=p.test(e)?1:0,h(e)}function d(e){return b=p.test(e)?1:0,h(e)}function f(){return n(t?v++ +".":g)}function h(e){var t=/^[ ]{0,3}([*+-]|\d+[.])\s/gm;return e.replace(t,f)}var m,g="-",v=1,y=1,b=1;if(e.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!e.before||/\n$/.test(e.before)||/^\n/.test(e.startTag)||(e.before+=e.startTag,e.startTag=""),!e.startTag||(m=/\d+[.]/.test(e.startTag),e.startTag="",e.selection=e.selection.replace(/\n[ ]{4}/g,"\n"),a.unwrap(e),e.skip(),m&&(e.after=e.after.replace(l,h)),t!==m)){e.before=e.before.replace(c,r),e.selection||(e.selection=i.placeholders.listitem);var w=f(),k=o(" ",w.length);e.after=e.after.replace(l,d),e.trim(!0),e.skip({before:y,after:b,any:!0}),e.startTag=w,a.wrap(e,s.lineLength-w.length),e.selection=e.selection.replace(/\n/g,"\n"+k)}}var o=e("../many"),i=e("../strings"),a=e("./wrapping"),s=e("./settings"),c=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,l=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,u=/^\s*([*+-])/,p=/[^\n]\n\n[^\n]/;
t.exports=r},{"../many":24,"../strings":43,"./settings":33,"./wrapping":34}],33:[function(e,t){"use strict";t.exports={lineLength:72}},{}],34:[function(e,t){"use strict";function n(e,t){function n(e,t){return i.test(e)?e:t+"\n"}var o=new RegExp("(.{1,"+t+"})( +|$\\n?)","gm");r(e),e.selection=e.selection.replace(o,n).replace(s,"")}function r(e){a.lastIndex=0,e.selection=e.selection.replace(a,"$1 $2")}var o="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",i=new RegExp("^"+o,""),a=new RegExp("([^\\n])\\n(?!(\\n|"+o+"))","g"),s=/\s+$/;t.exports={wrap:n,unwrap:r}},{}],35:[function(e,t){"use strict";function n(e){function t(){var e=r.read();i!==e&&(i=e,r.trigger("change",e))}var n=this.textarea=e.textarea,r=this,i=this.read(),a=o.debounce(t,100);n.addEventListener("blur",t),n.addEventListener("cut",t),n.addEventListener("paste",t),n.addEventListener("change",a),n.addEventListener("input",a),n.addEventListener("keypress",a)}var r=e("../../events"),o=e("../../utils");n.prototype.focus=function(){this.textarea.focus()},n.prototype.read=function(){return this.textarea.value},n.prototype.write=function(e){this.textarea.value=e},n.prototype.current=function(){return this.textarea},n.prototype.writeSelection=function(e){this.textarea.focus(),this.textarea.selectionStart=e.start,this.textarea.selectionEnd=e.end,this.textarea.scrollTop=e.scrollTop},n.prototype.readSelection=function(e){e.start=this.textarea.selectionStart,e.end=this.textarea.selectionEnd},n.prototype.toMarkdown=function(){return this.read()},n.prototype.writeMarkdown=function(e){return this.write((e||"").trim())},n.prototype.toHTML=function(){return this.editor.parseMarkdown(this.read())},r.extend(n),t.exports=n},{"../../events":9,"../../utils":45}],36:[function(e,t){(function(n){"use strict";function r(e,t){function n(){var e=o.read();i!==e&&(i=e,o.trigger("change",e))}this.editor=e;var r=this.editable=u.createElement("div");r.className=["wk-wysiwyg","wk-hide"].concat(t.classes).join(" "),r.contentEditable=!0;var o=this,i=this.read(),a=l.debounce(n,200);r.addEventListener("blur",n),r.addEventListener("cut",n),r.addEventListener("paste",n),r.addEventListener("textinput",a),r.addEventListener("input",a),r.addEventListener("keypress",a),r.addEventListener("keyup",a)}function o(e,t,n,r){function a(e){o(e,t,s,!1)}var s=n||{text:""};if(!e)return s;var c=1===e.nodeType,l=3===e.nodeType;return t(s,e),l&&(s.text+=i(e)),c&&(e.outerHTML.match(p)&&(s.text+=RegExp.$1),Array.prototype.slice.call(e.childNodes).forEach(a),e.outerHTML.match(d)&&(s.text+=RegExp.$1)),r!==!1&&e.nextSibling?o(e.nextSibling,t,s):s}function i(e,t){return 3===e.nodeType?t===!1?e.textContent||e.innerText||"":a(e):""}function a(e){e=e||"",e=3===e.nodeType?e.cloneNode():u.createTextNode(e);var t=u.createElement("div");return t.appendChild(e),t.innerHTML||""}function s(e){if(e.nodeType)return e.textContent||e.innerText||"";var t=u.createElement("div");return t.textContent=e,t.textContent}var c=e("../../events"),l=e("../../utils"),u=n.document,p=/^(<[^>]+(?: [^>]*)?>)/,d=/(<\/[^>]+>)$/,f=/^<p><\/p>\n?$/i;r.prototype.focus=function(e){e?this.editable.focus():setTimeout(this.editable.focus.bind(this.editable),0)},r.prototype.read=function(){return this.editable.innerHTML},r.prototype.write=function(e){this.editable.innerHTML=e},r.prototype.current=function(){return this.editable},r.prototype.writeSelection=function(e){function t(e,t){function n(e){return Math.max(0,Math.min(u,e))}var o=s(e.text).length,u=i(t,!1).length,d=o+u;!l&&d>=r&&(c.setStart(t,n(r-o)),l=!0),!p&&d>=a&&(c.setEnd(t,n(a-o)),p=!0)}var n=e.cachedChunks||e.getChunks(),r=s(n.before).length,a=r+s(n.selection).length,c=u.createRange(),l=!1,p=!1;o(this.editable.firstChild,t),this.editable.focus();var d=u.getSelection();d.removeAllRanges(),d.addRange(c)},r.prototype.readSelection=function(e){function t(e,t){var r=t.textContent||t.innerText||"";t===n.anchorNode&&(e.start=e.text.length+a(r.substring(0,n.anchorOffset)).length),t===n.focusNode&&(e.end=e.text.length+a(r.substring(0,n.focusOffset)).length)}var n=u.getSelection(),r=o(this.editable.firstChild,t),i=r.start||0,s=r.end||0;e.text=r.text,s>i?(e.start=i,e.end=s):(e.start=s,e.end=i)},r.prototype.toMarkdown=function(){return this.editor.parseHTML(this.read())},r.prototype.writeMarkdown=function(e){var t=this.editor.parseMarkdown(e||"").replace(f,"").trim();return this.write(t)},r.prototype.toHTML=function(){return this.read()},c.extend(r),t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../events":9,"../../utils":45}],37:[function(e,t){"use strict";function n(e){var t;return function(){return t?void 0:(t=!0,e.apply(this,arguments))}}t.exports=n},{}],38:[function(e,t){"use strict";function n(e){var t,n=[],o=a.getElementsByTagName("*");for(t in o)-1!==r(o[t].className).indexOf(r(e))&&n.push(o[t]);return n}function r(e){return" "+e+" "}function o(){i(a.body.querySelectorAll?a.body.querySelectorAll(".wk-prompt"):n("wk-prompt"))}function i(e){var t,n=e.length;for(t=0;n>t;t++)e[t].parentElement.removeChild(e[t])}var a=document;t.exports=o},{}],39:[function(e,t){"use strict";function n(e,t){function n(n){t[n]&&(e[n].className+=" "+t[n])}Object.keys(e).forEach(n)}function r(e,t){function r(){M.input.focus()}function f(e){var t=e.which||e.keyCode;t===c&&(m(),e.preventDefault())}function h(e){var t=e.which||e.keyCode;t===l&&(g(),e.preventDefault())}function m(){g(),t({definitions:[M.input.value]})}function g(){S&&v(!0),M.dialog.parentElement&&M.dialog.parentElement.removeChild(M.dialog)}function v(e){var t=e?"remove":"add";d[t+"EventListener"]("dragenter",y),d[t+"EventListener"]("dragend",b),d[t+"EventListener"]("mouseout",b)}function y(){i.add(T.area,u),i.add(T.area,p)}function b(){i.rm(T.area,u),i.rm(T.area,p),s.stop(e.surface.droparea)}function w(){T=o.uploads(M,a.prompts.types+(S.restriction||e.type+"s")),v(),T.area.addEventListener("dragover",k,!1),T.area.addEventListener("drop",x,!1),n(T,e.classes.prompts)}function k(e){E(e),e.dataTransfer.dropEffect="copy"}function x(e){b(),E(e),$.submit(e.dataTransfer.files)}function E(e){e.stopPropagation(),e.preventDefault()}var T,C=a.prompts[e.type],M=o({id:"wk-prompt-"+e.type,title:C.title,description:C.description,placeholder:C.placeholder});M.cancel.addEventListener("click",g),M.close.addEventListener("click",g),M.ok.addEventListener("click",m),M.input.addEventListener("keypress",f),M.dialog.addEventListener("keydown",h),n(M,e.classes.prompts);var S=e.upload;"string"==typeof S&&(S={url:S});var $=null;S&&($=w(),e.autoUpload&&$.submit(e.autoUpload)),setTimeout(r,0)}var o=e("./render"),i=e("../classes"),a=e("../strings"),s=e("../uploads"),c=13,l=27,u="wk-dragging",p="wk-prompt-upload-dragging",d=document.documentElement;t.exports=r},{"../classes":7,"../strings":43,"../uploads":44,"./render":40}],40:[function(e,t){(function(n){"use strict";function r(e,t,n){var r=l.createElement(e);return r.className=t,n&&(r.textContent=n),r}function o(e){var t={dialog:r("article","wk-prompt "+e.id),close:r("a","wk-prompt-close"),header:r("header","wk-prompt-header"),h1:r("h1","wk-prompt-title",e.title),section:r("section","wk-prompt-body"),desc:r("p","wk-prompt-description",e.description),inputContainer:r("div","wk-prompt-input-container"),input:r("input","wk-prompt-input"),cancel:r("button","wk-prompt-cancel","Cancel"),ok:r("button","wk-prompt-ok","Ok"),footer:r("footer","wk-prompt-buttons")};return t.ok.type="button",t.header[c](t.h1),t.section[c](t.desc),t.section[c](t.inputContainer),t.inputContainer[c](t.input),t.input.placeholder=e.placeholder,t.cancel.type="button",t.footer[c](t.cancel),t.footer[c](t.ok),t.dialog[c](t.close),t.dialog[c](t.header),t.dialog[c](t.section),t.dialog[c](t.footer),l.body[c](t.dialog),t}function i(e,t){function n(){a.add(l.upload,"wk-focused")}function o(){a.rm(l.upload,"wk-focused")}var i="wk-prompt-fileupload",l={area:r("section","wk-prompt-upload-area"),warning:r("p","wk-prompt-error wk-warning",t),failed:r("p","wk-prompt-error wk-failed",s.prompts.uploadfailed),upload:r("label","wk-prompt-upload"),uploading:r("span","wk-prompt-progress",s.prompts.uploading),drop:r("span","wk-prompt-drop",s.prompts.drop),dropicon:r("p","wk-drop-icon wk-prompt-drop-icon"),browse:r("span","wk-prompt-browse",s.prompts.browse),dragdrop:r("p","wk-prompt-dragdrop",s.prompts.drophint),fileinput:r("input",i)};return l.area[c](l.drop),l.area[c](l.uploading),l.area[c](l.dropicon),l.upload[c](l.browse),l.upload[c](l.fileinput),l.fileinput.id=i,l.fileinput.type="file",l.fileinput.multiple="multiple",e.dialog.className+=" wk-prompt-uploads",e.inputContainer.className+=" wk-prompt-input-container-uploads",e.input.className+=" wk-prompt-input-uploads",e.section.insertBefore(l.warning,e.inputContainer),e.section.insertBefore(l.failed,e.inputContainer),e.section[c](l.upload),e.section[c](l.dragdrop),e.section[c](l.area),e.desc.textContent=e.desc.textContent+s.prompts.upload,l.fileinput.addEventListener("focus",n),l.fileinput.addEventListener("blur",o),l}var a=e("../classes"),s=e("../strings"),c="appendChild",l=n.document;o.uploads=i,t.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../classes":7,"../strings":43}],41:[function(e,t){"use strict";function n(e,t){e.textContent=o.buttons[t]||t}function r(e,t){e.textContent=o.modes[t]||t}var o=e("./strings");t.exports={modes:r,commands:n}},{"./strings":43}],42:[function(e,t){"use strict";function n(e){this.boundHandler=this.handleEvent.bind(this),this.handlers={},e&&this.attach(e)}n.prototype.attach=function(e){e.addEventListener("keydown",this.boundHandler,!1)},n.prototype.detach=function(e){e.removeEventListener("keydown",this.boundHandler,!1)},n.prototype.add=function(e,t,n){return 2===arguments.length&&(n=t,t=!1),this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push({shift:!!t,fn:n}),this},n.prototype.remove=function(e,t,n){if(2===arguments.length&&(n=t,t=void 0),this.handlers[e]&&this.handlers[e].length){for(var r=0,o=this.handlers[e].length;o>r;r++){var i=this.handlers[e][r];if(i.fn===n&&("undefined"==typeof t||i.shift===t))break}o>r&&this.hanlders.splice(r,1)}return this},n.prototype.clear=function(){this.handlers={}},n.prototype.handleEvent=function(e){if(e.ctrlKey||e.metaKey){var t=e.key;if(t&&this.handlers[t])for(var n=0,r=this.handlers[t].length;r>n;n++){var o=this.handlers[t][n];e.shiftKey===o.shift&&(o.fn(e),e.preventDefault(),e.stopPropagation())}}},t.exports=n},{}],43:[function(e,t){"use strict";t.exports={placeholders:{bold:"strong text",italic:"emphasized text",quote:"quoted text",code:"code goes here",listitem:"list item",heading:"Heading Text",link:"enter link description",image:"image description",attachment:"attachment description"},titles:{bold:"Strong <strong> Ctrl+B",italic:"Emphasis <em> Ctrl+I",quote:"Blockquote <blockquote> Ctrl+J",code:"Code Sample <pre><code> Ctrl+E",ol:"Numbered List <ol> Ctrl+O",ul:"Bulleted List <ul> Ctrl+U",heading:"Heading <h1>, <h2>, ... Ctrl+D",link:"Hyperlink <a> Ctrl+K",image:"Image <img> Ctrl+G",attachment:"Attachment Ctrl+Shift+K",markdown:"Markdown Mode Ctrl+M",html:"HTML Mode Ctrl+H",wysiwyg:"Preview Mode Ctrl+P"},buttons:{bold:"B",italic:"I",quote:"“",code:"</>",ol:"1.",ul:"⦿",heading:"Tt",link:"Link",image:"Image",attachment:"Attachment",hr:"↵"},prompts:{link:{title:"Insert Link",description:"Type or paste the url to your link",placeholder:'http://example.com/ "title"'},image:{title:"Insert Image",description:"Enter the url to your image",placeholder:'http://example.com/public/image.png "title"'},attachment:{title:"Attach File",description:"Enter the url to your attachment",placeholder:'http://example.com/public/report.pdf "title"'},types:"You can only upload ",browse:"Browse...",drophint:"You can also drag files from your computer and drop them here!",drop:"Drop your file here to begin upload...",upload:", or upload a file",uploading:"Uploading your file...",uploadfailed:"The upload failed! That's all we know."},modes:{wysiwyg:"wysiwyg",markdown:"m↓"}}},{}],44:[function(e,t){"use strict";function n(e,t,n,p,d){function f(){s.add(t,c),s.add(t,l)}function h(){a(t)}function m(e){i(e),f(),e.dataTransfer.dropEffect="copy"}function g(e){h(),i(e),n.runCommand(function(t,r){var o=Array.prototype.slice.call(e.dataTransfer.files),i=v(o);n.linkOrImageOrAttachment(i,o).call(this,r,t)})}function v(e){return p.images&&!p.attachments?"image":!p.images&&p.attachments?"attachment":e.every(r(p.images.validate||o))?"image":"attachment"}var y=d?"remove":"add";u[y+"EventListener"]("dragenter",f),u[y+"EventListener"]("dragend",h),u[y+"EventListener"]("mouseout",h),u[y+"EventListener"]("dragover",m,!1),u[y+"EventListener"]("drop",g,!1)}function r(e){return function(t){return e(t)}}function o(){return!1}function i(e){e.stopPropagation(),e.preventDefault()}function a(e){s.rm(e,c),s.rm(e,l)}var s=e("./classes"),c="wk-dragging",l="wk-container-dragging",u=document.documentElement;n.stop=a,t.exports=n},{"./classes":7}],45:[function(e,t,n){"use strict";"function"!=typeof Object.assign&&(Object.assign=function(e){if(null===e||void 0===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!==r&&void 0!==r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t}),function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}return"function"==typeof window.CustomEvent?!1:(e.prototype=window.Event.prototype,void(window.CustomEvent=e))}(),function(e){try{return new n("test"),!1}catch(t){}var n=function(t,n){n=n||{bubbles:!1,cancelable:!1};var r=document.createEvent("MouseEvent");return r.initMouseEvent(t,n.bubbles,n.cancelable,e,0,0,0,0,0,!1,!1,!1,!1,0,null),r};n.prototype=Event.prototype,e.MouseEvent=n}(window);var r=n.exists=function(e){return void 0!==e&&null!==e};n.clone=function(e){return Object.assign({},e)},n.extend=Object.assign,n.defaultsDeep=function(e){if(!r(e))throw new TypeError("Cannot convert undefined or null to object");for(var t=n.clone(e),o=1;o<arguments.length;o++){var i=arguments[o];if(null!==i)for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(Object.prototype.hasOwnProperty.call(t,a)?r(t[a])&&r(i[a])&&"object"==typeof t[a]&&"object"==typeof i[a]&&(t[a]=n.defaultsDeep(t[a],i[a])):t[a]="object"==typeof i[a]&&null!==i[a]?n.clone(i[a]):i[a])}return t},n.dispatchCustomEvent=function(e,t,n){var r=new CustomEvent(t,n);e.dispatchEvent(r)},n.dispatchBrowserEvent=function(e,t){var n=new Event(t);e.dispatchEvent(n)},n.dispatchClickEvent=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},n.debounce=function(e,t){var n;return function(){var r=this,o=Array.prototype.slice.call(arguments);clearTimeout(n),n=setTimeout(function(){n=void 0,e.apply(r,o)},t)}}},{}]},{},[3])(3)});